---
title: "Ansible Execution Environment: Optimizando la Automatización con Contenedores"
datePublished: Fri Jan 31 2025 18:27:56 GMT+0000 (Coordinated Universal Time)
cuid: cm6l3k8kh000309l83d4qcvq6
slug: ansible-execution-environment-optimizando-la-automatizacion-con-contenedores
tags: ansible, automation, containers

---
= Ansible Execution Environment: Optimizando la Automatización con Contenedores
:source-highlighter: pygments
:toc:
:toclevels: 3
:imagesdir: images

== Introducción

En un mundo donde la infraestructura híbrida y multi-nube es la norma, Ansible Execution Environment (EE) emerge como una solución revolucionaria para resolver problemas de compatibilidad y reproducibilidad. Según el https://www.ansible.com/resources/analyst-reports/trends-in-automation[Informe Ansible 2023], el 67% de los equipos de DevOps enfrentan problemas de dependencias en sus flujos de automatización. Los EEs ofrecen una respuesta elegante a este desafío mediante contenedores estandarizados.

image::ansible-ee-diagram.png[Diagrama de Ansible EE, scaledwidth=80%]
_Fuente: Documentación oficial de Ansible_

== ¿Qué es un Ansible Execution Environment?

Un *Ansible Execution Environment* es un contenedor OCI (Open Container Initiative) que encapsula:

* Versión específica de Ansible Core
* Colecciones Ansible requeridas
* Dependencias de Python y binarios del sistema
* Herramientas adicionales (e.g., git, openssh-client)

.Estructura interna típica:
[source,bash]
----
/usr/bin/ansible
/usr/lib/python3.9/site-packages/ansible
/usr/local/lib/python3.9/site-packages/ansible_collections
/opt/ansible/collections/ansible_collections
----

== Casos de Uso Clave

1. *Equipos multidisciplinares* con diferentes configuraciones locales
2. *Pipelines CI/CD* donde la consistencia es crítica
3. *Entornos regulados* que requieren imágenes certificadas
4. *Automatización a escala* con Ansible Automation Platform

== Construyendo un EE Personalizado: Ejemplo Detallado

=== 1. Configuración de `execution-environment.yml`

[source,yaml]
----
include::resources/execution-environment.yml[]
----

=== 2. Archivos de Dependencias

*requirements.txt*:
[source,text]
----
include::resources/requirements.txt[]
----

*collections/requirements.yml*:
[source,yaml]
----
include::resources/collections-requirements.yml[]
----

*bindep.txt*:
[source,text]
----
include::resources/bindep.txt[]
----

=== 3. Construcción Avanzada

[source,bash]
----
ansible-builder build \
  -t my-ee:1.0.0 \
  --container-runtime podman \
  --build-arg NVIDIA_VISIBLE_DEVICES=all
----

== Integración con Ansible Automation Platform (AAP)

.Pasos para integración:
1. Construir la imagen y subirla al registro corporativo
2. Sincronizar en AAP vía GUI o API:

[source,bash]
----
curl -X POST \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"name": "my-ee", "image": "registry.example.com/my-ee:1.0.0"}' \
  https://aap.example.com/api/v2/execution_environments/
----

3. Asignar el EE a una organización y proyectos específicos

== Mejores Prácticas Operativas

[cols="1,3"]
|===
| *Práctica* | *Implementación*

| Versionado Semántico
| `my-ee-1.2.3-py3.9`

| Escaneo de Seguridad
| Integrar con Trivy o Clair

| Actualizaciones
| Automatizar builds con RenovateBot

| Tamaño Optimizado
| Usar imágenes base minimalistas como `ubi-micro`
|===

== Ejemplo Completo: EE para AWS

[source,yaml]
----
include::resources/aws-ee.yml[]
----

== Monitoreo y Depuración

.Inspeccionar dependencias:
[source,bash]
----
podman run --rm my-ee ansible-galaxy collection list
----

.Ejecución con debug:
[source,bash]
----
ansible-navigator run playbook.yml \
  --ee my-ee \
  --mode stdout \
  --verbose \
  --log-level debug
----

.Generar SBOM:
[source,bash]
----
syft my-ee:latest -o json > sbom.json
----

== Referencias Clave

1. https://docs.ansible.com/automation-controller/latest/html/userguide/execution_environments.html[Documentación Oficial de Execution Environments]
2. https://ansible-builder.readthedocs.io/en/stable/[Guía de ansible-builder]
3. https://www.redhat.com/en/resources/ansible-best-practices-ebook[Red Hat Enterprise Ansible Best Practices]
4. https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html[OWASP Container Security Guide]

== Conclusión

Los Execution Environments representan un cambio de paradigma en la automatización con Ansible. Al adoptar esta tecnología, los equipos pueden:

* Reducir errores de "funciona en mi máquina" en un 73% (Datos: Ansible State of Automation 2023)
* Acelerar el onboarding de nuevos miembros
* Implementar políticas de seguridad consistentes

[NOTE]
====
*Desafío Práctico:* 
1. Clona el repositorio oficial de https://github.com/ansible/ansible-ee-examples[ansible-ee-examples]
2. Construye un EE con soporte para Azure y Kubernetes
3. Ejecuta un playbook multi-nube usando tu nuevo EE

¡Comparte tus resultados en nuestra https://discord.gg/ansible[comunidad de Discord] y participa en nuestro reto mensual de automatización!
====

[quote, Sarah Johnson, Ingeniera Principal de DevOps @CloudScale Inc.]
____
La consistencia es la clave de la automatización a escala. Los Execution Environments son nuestro traje a medida para el éxito en la nube.
____